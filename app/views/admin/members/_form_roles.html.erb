<fieldset id="member_activation_form" class="clearfix">
  <legend><%=t('members.shared.activation')%></legend>  
  
  <p class="field">
    <%= f.check_box :enabled %>
    <%= f.label :enabled %>
  </p>
  <% if RefinerySetting::find_or_set('memberships_timed_accounts', true) %>
  <p class="field">
  <span>
    <% if f.object.member_until %>
      <%= t('.member_until')%> <b><%= f.object.member_until.strftime('%d/%m/%Y') %></b>
      <%= t('.extend_membership_by')%> <%= f.select :add_to_member_until, [[]]+(1..10).collect{|n| t('years', :count => n)} %>
    <% else %>
      <%= t('.not_yet_member')%> 
      <%= t('.make_member_for')%> <%= f.select :add_to_member_until, [[]]+(1..10).collect{|n| t('years', :count => n)} %>
    <% end %>
  </span>
  </p>
  <% end %>
</fieldset>

<% if Role.where(['title NOT IN (?)',['Superuser','Refinery','Member']]).count > 0 %>
  <fieldset id="member_roles_form" class="clearfix">
    <legend><%=t('members.shared.user_roles')%></legend>  
    
    <% Role.where(['title NOT IN (?)',['Superuser','Refinery','Member']]).all.each_with_index do | role, idx | %>
    <p class="role">
      <%= check_box_tag "member[role_ids][]", role.id, f.object.roles.include?(role), :id => "member_role_#{idx}" %>
      <label for="member_role_<%= idx %>"><%= role.title %></label>
    </p>
    <% end %> 
  </fieldset>
<% end %>

<% if RefinerySetting::find_or_set('memberships_timed_accounts', true) && (!f.object.member_until||f.object.lapsed?) %>
<% content_for :javascripts do %>
<script type="text/javascript">
$(function(){
  $('#member_enabled').change(function(){
    var sel = $('#member_add_to_member_until').get(0);
    if(sel) {
      if($(this).is(':checked') && parseInt(sel.options[0].value||0) < 1){
        for(var n = 0; n < sel.options.length-1; n++){
          var old = sel.options[n+1];
          sel.options[n] = new Option(old.text, old.value);
        }
        sel.options.length = sel.options.length-1;
      } else if(!$(this).is(':checked') && parseInt(sel.options[0].value||0) > 0){
        for(var n = sel.options.length; n > 0; n--){
          var old = sel.options[n-1];
          sel.options[n] = new Option(old.text, old.value);
        }
        sel.options[0] = new Option();
      }      
    }
  });
});
</script>
<% end %>
<%end%>
